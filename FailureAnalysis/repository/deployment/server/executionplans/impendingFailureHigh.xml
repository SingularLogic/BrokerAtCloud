<?xml version="1.0" encoding="UTF-8"?>
<executionPlan name="impendingFailureHigh" statistics="enable"
  trace="enable" xmlns="http://wso2.org/carbon/eventprocessor">
  <description/>
  <siddhiConfiguration>
    <property name="siddhi.persistence.snapshot.time.interval.minutes">0</property>
    <property name="siddhi.enable.distributed.processing">false</property>
  </siddhiConfiguration>
  <importedStreams>
    <stream as="avgCpuLoadStream" name="avgCpuLoadStream" version="1.0.0"/>
    <stream as="avgMemoryLoadStream" name="avgMemoryLoadStream" version="1.0.0"/>
    <stream as="avgStorageLoadStream" name="avgStorageLoadStream" version="1.0.0"/>
    <stream as="processesStream" name="processesStream" version="1.0.0"/>
    <stream as="requestsStream" name="requestsStream" version="1.0.0"/>
  </importedStreams>
  <queryExpressions><![CDATA[
from avgCpuLoadStream[avgCpuLoad >= 99] as c
join avgMemoryLoadStream[avgMemoryLoad >= 99] as m on c.service == m.service
select c.service, 'cpuOverload, memoryOverload' as cause
insert into impendingFailureHighStream;

from avgCpuLoadStream[avgCpuLoad >= 99] as c
join avgStorageLoadStream[avgStorageLoad >= 99] as s on c.service == s.service
select c.service, 'cpuOverload, storageOverload' as cause
insert into impendingFailureHighStream;

from avgMemoryLoadStream[avgMemoryLoad >= 99] as m
join avgStorageLoadStream[avgStorageLoad >= 99] as s on m.service == s.service
select m.service, 'memoryOverload, storageOverload' as cause
insert into impendingFailureHighStream;

from processesStream[processes >= 1000]
select service, 'processesOverload' as cause
insert into impendingFailureHighStream;

from requestsStream[requests >= 1000]
select service, 'requestsOverload' as cause
insert into impendingFailureHighStream;
  ]]></queryExpressions>
  <exportedStreams>
    <stream name="impendingFailureHighStream"
      valueOf="impendingFailureHighStream" version="1.0.0"/>
  </exportedStreams>
</executionPlan>
