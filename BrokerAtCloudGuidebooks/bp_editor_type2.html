<!DOCTYPE html>
<html prefix="rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns#
              rdfs: http://www.w3.org/2000/01/rdf-schema#
              foaf: http://xmlns.com/foaf/0.1/
              owl: http://www.w3.org/2002/07/owl#
              dcterms: http://purl.org/dc/terms/
              gr: http://purl.org/goodrelations/v1#
              usdl-core: http://www.linked-usdl.org/ns/usdl-core#

              vcard: http://www.w3.org/2006/vcard/ns#
              xsd: http://www.w3.org/2001/XMLSchema#">

<head>
    <!--link rel="stylesheet" type = "text/css" href="styles.css"-->
    <style>
        .droptarget {
            float: down;
            <!-- width: 400px;
            --> height: 50px;
            margin: 5px;
            padding: 5px;
            font-size: 14pt;
            border: 5px solid #ffaaaa;
            background-color: lightgrey;
        }
    </style>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <title>USDL Broker Policy Editor with multiple instantiated profiles</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=980" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="shortcut icon" href="images/usdl-solo.ico" />
    <link rel="apple-touch-icon" href="images/splash_about.png" />
    <link rel="stylesheet" href="jquery/css/smoothness/jquery-ui-1.8.6.custom.css" />
    <link rel="stylesheet" href="css/jquery-ui-timepicker-addon.css" />
    <!--link rel="stylesheet" href="css/jquery.jgrowl.css" type="text/css"/-->
    <!--link rel="stylesheet" href="css/ui.sa.css" />
<link rel="stylesheet" href="css/sapUiUx3.css" />
<link rel="stylesheet" href="css/infovis.css" /-->

    <!-- Bootstrap -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet">

    <!-- Bootstrap theme -->
    <link href="bower_components/bootstrap/dist/css/bootstrap-theme.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="template.css" rel="stylesheet">

    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/jquery-ui/jquery-ui.min.js"></script>
    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!--script type="text/javascript" src="jquery/js/jquery-1.6.2.min.js" ></script-->
    <!--script type="text/javascript" src="jquery/js/jquery-ui-1.8.16.custom.min.js"></script-->
    <script type="text/javascript" src="js/jquery-ui-timepicker-addon.js"></script>
    <script type="text/javascript" src="js/jquery.editable-1.3.3.js"></script>
    <script type="text/javascript" src="js/jquery.livequery.js"></script>
    <script type="text/javascript" src="js/jquery.clicknscroll.v1.0.js"></script>
    <script type="text/javascript" src="js/jquery.sa.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.js"></script>
    <script type="text/javascript" src="js/mime.js"></script>
    <script type="text/javascript" src="js/slidedeck.js"></script>
    <script type="text/javascript" src="js/jquery.jgrowl_minimized.js"></script>
    <script type="text/javascript" src="js/Math.uuid.js"></script>
    <script type="text/javascript" src="js/base64.js"></script>
    <!--script type="text/javascript" src="js/jit-yc.js"></script-->
    <script type="text/javascript" src="rdfquery/jquery.json.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.uri.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.xmlns.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.curie.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.datatype.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.rdf.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.rdfa.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.rdf.json.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.rdf.xml.js"></script>
    <script type="text/javascript" src="rdfquery/jquery.rdf.turtle.js"></script>
    <!--<script type="text/javascript" src="js/usdl.editor.cas.js"></script> -->
    <script type="text/javascript">
        function deleteQualitativeTables() {
            var anchor = document.getElementById("qualvalues");
            anchor.innerHTML = "";
            // tbd
        }

        function deactivateInputFields() {
            document.getElementById("bp_namespace").disabled = true;
            document.getElementById("bp_business_entity").disabled = true;
            document.getElementById("bp_legal_name").disabled = true;
            document.getElementById("bp_instance").disabled = true;
            document.getElementById("bp_model").disabled = true;
            document.getElementById("slp_class").disabled = true;
            document.getElementById("classtaxpref").disabled = true;
            document.getElementById("classtaxroot").disabled = true;
            document.getElementById("classtaxURI").disabled = true;
            document.getElementById("valid_from").disabled = true;
            document.getElementById("valid_through").disabled = true;
            document.getElementById("successor_of_bp").disabled = true;
            document.getElementById("onboarding_deprecated_from").disabled = true;
            document.getElementById("recommendation_deprecated_from").disabled = true;
            deactivateClassTaxTable();

        }

        function deactivateClassTaxTable() {
            var qual_sl_table = document.getElementById("classtaxconcepts");
            for (i = 1; i < qual_sl_table.rows.length; i++) {

                qual_sl_table.rows[i].cells[0].childNodes[0].disabled = true;
                qual_sl_table.rows[i].cells[1].childNodes[0].disabled = true;
                qual_sl_table.rows[i].cells[2].childNodes[0].disabled = true;
            }
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function findBase(kb) {
            var base = kb.databank.baseURI
            var services = kb.where("?brokerPolicy a ?serviceModel")
                .where("?serviceModel rdfs:subClassOf usdl-core:ServiceModel")
                .where("?brokerPolicy usdl-core-cb:validFrom ?validFrom");
            if (services[0]) {
                //services.each(function () {
                var selection_class = services[0].serviceModel; //this["serviceModel"];
                var selection_instance = services[0].brokerPolicy; //this["brokerPolicy"];

                var url_class = selection_class.value._string;
                var url_instance = selection_instance.value._string;
                var validFrom = services[0].validFrom;

                base = url_class.split('#')[0];
                document.getElementById("bp_namespace").value = base;
                // Assign the service model class and instance to the business policy form
                document.getElementById("bp_model").value = url_class.split('#')[1];
                document.getElementById("bp_instance").value = url_instance.split('#')[1];
                // Assign the service model class and instance to the service description form
                document.getElementById("servicemodel_class").value = url_class.split('#')[1];
                document.getElementById("servicemodel").value = url_instance.split('#')[1];
                document.getElementById("valid_from").value = validFrom.value;
                //})
            }

            var validthrough = kb.where("?brokerPolicy a ?serviceModel")
                .where("?serviceModel rdfs:subClassOf usdl-core:ServiceModel")
                .where("?brokerPolicy usdl-core-cb:validThrough ?validThrough");

            validthrough.each(function () {
                var validThrough = this["validThrough"];
                document.getElementById("valid_through").value = validThrough.value;
            });
            var successor = kb.where("?brokerPolicy a ?serviceModel")
                .where("?serviceModel rdfs:subClassOf usdl-core:ServiceModel")
                .where("?brokerPolicy gr:successorOf ?successor");
            successor.each(function () {
                var successor_of = this["successor"];
                document.getElementById("successor_of_bp").value = successor_of.value._string;
            });
            var onboarding = kb.where("?brokerPolicy a ?serviceModel")
                .where("?serviceModel rdfs:subClassOf usdl-core:ServiceModel")
                .where("?brokerPolicy gr:successorOf ?successor")
                .where("?brokerPolicy usdl-core-cb:deprecationOnboardingTimePoint ?onboarding");
            onboarding.each(function () {
                var onboarding_date = this["onboarding"];
                document.getElementById("onboarding_deprecated_from").value = onboarding_date.value;
            });
            var recommendation = kb.where("?brokerPolicy a ?serviceModel")
                .where("?serviceModel rdfs:subClassOf usdl-core:ServiceModel")
                .where("?brokerPolicy gr:successorOf ?successor")
                .where("?brokerPolicy usdl-core-cb:deprecationRecommendationTimePoint ?recommendation");
            recommendation.each(function () {
                var recommendation_date = this["recommendation"];
                document.getElementById("recommendation_deprecated_from").value = recommendation_date.value;
            });

            var business_entity = kb.where("?bentity a gr:BusinessEntity")
                .where("?bentity gr:legalName ?legalName")
            business_entity.each(function () {
                var bizentity = this["bentity"];
                var legalname = this["legalName"];

                var url_bizentity = bizentity.value._string;

                // Assign the service model class and instance to the business policy form
                document.getElementById("bp_business_entity").value = url_bizentity.split('#')[1];
                document.getElementById("bp_legal_name").value = legalname.value;

            })

            return base
        }

        function addConcept() {
            var table = document.getElementById("class_table");
            var rowCount = table.rows.length;
            var row = table.insertRow(rowCount);
            var cell1 = row.insertCell(0);
            cell1.innerHTML = "<div class='checkbox'><label><input type='checkbox' value=''></label></div>";
            var cell2 = row.insertCell(1);
            cell2.innerHTML = rowCount + 1;
            var cell3 = row.insertCell(2);
            var tax_class = document.getElementById("classtaxonomy").value;
            cell3.innerHTML = tax_class;
        }

        function deleteConcept() {
            try {
                var table = document.getElementById("class_table");
                var rowCount = table.rows.length;
                for (var i = 0; i < rowCount; i++) {
                    var row = table.rows[i];
                    var chkbox = row.cells[0].childNodes[0].childNodes[0].childNodes[0];
                    if (null != chkbox && true == chkbox.checked) {
                        table.deleteRow(i);
                        rowCount--;
                        i--;
                    }
                }
            } catch (e) {
                alert(e);
            }
        }

        //output
        function addClassificationConceptsToSD(kb) {
            var class_table = document.getElementById("class_table");
            for (i = 0; i < class_table.rows.length; i++) {
                kb.add("<" + document.getElementById("sd_model").value + "> usdl-core-cb:hasClassificationDimension " + "<" + class_table.rows[i].cells[2].innerHTML + "> .")
            }
            return kb;
        }

        //output
        function addQualServiceLevelsToSD(kb, qsldSource) {
            var qual_sl_table = document.getElementById(qsldSource);
            for (i = 1; i < qual_sl_table.rows.length; i++) {
                var qual_value_type = qual_sl_table.rows[i].cells[0].childNodes[0].value;
                // SL instance
                kb.add("<SL" + qual_value_type + "Instance> a " + "bp:SL" + qual_value_type + " .")
                    .add("<" + document.getElementById("slp").value + "> bp:hasSL" + qual_value_type + " <SL" + qual_value_type + "Instance> .")

                // SLE instance
                kb.add("<SLE" + qual_value_type + "Instance> a " + "bp:SLE" + qual_value_type + " .")
                    .add("<SL" + qual_value_type + "Instance> bp:hasSLE" + qual_value_type + " <SLE" + qual_value_type + "Instance> .")

                // Var instance
                kb.add("<Var" + qual_value_type + "Instance> a " + "bp:Var" + qual_value_type + " .")
                    .add("<SLE" + qual_value_type + "Instance> bp:hasVar" + qual_value_type + " <Var" + qual_value_type + "Instance> .")

                // bind var instance to the qual value instance
                var ddlb = document.getElementById("ddlb_" + qual_value_type);
                kb.add("<Var" + qual_value_type + "Instance>  " + "bp:hasDefault" + qual_value_type + " <" + ddlb.value + "> .");

            }
            return kb;
        }

        //output
        function addQuantServiceLevelsToSD(kb) {
            var prefix = 'quantitativeValues_';
            var quant_sl_size = document.getElementById("slQuantitative").children.length;
            for (i = 1; i <= quant_sl_size; i++) {
                var idType = prefix + i + '_type';
                var idInstance = prefix + i + '_instance';
                var idInstanceDesc = prefix + i + '_instanceDesc';
                var idUom = prefix + i + '_uom';
                var idIsRange = prefix + i + '_isRange';
                var idValueType = prefix + i + '_valueType';
                var idMinValue = prefix + i + '_minValue';
                var idMaxValue = prefix + i + '_maxValue';
                var idValue = prefix + i + '_value';

                var quant_value_typeNG = document.getElementById(idType).innerHTML;
                var quant_value_instNG = document.getElementById(idInstance).value;
                var uomNG = document.getElementById(idUom).value;
                var isRangeNG = document.getElementById(idIsRange).checked;
                var minValueNG = document.getElementById(idMinValue).value;
                var maxValueNG = document.getElementById(idMaxValue).value;
                var valueNG = undefined;
                if (!isRangeNG) {
                    valueNG = document.getElementById(idValue).value;
                }
                var valueTypeNG = document.getElementById(idValueType).value;
                var instanceDescriptionNG = document.getElementById(idInstanceDesc).value;

                // SL instance
                kb.add("<SL" + quant_value_typeNG + "Instance> a " + "bp:SL" + quant_value_typeNG + " .");
                kb.add("<" + document.getElementById("slp").value + "> bp:hasSL" + quant_value_typeNG + " <SL" + quant_value_typeNG + "Instance> .");

                // SLE instance
                kb.add("<SLE" + quant_value_typeNG + "Instance> a " + "bp:SLE" + quant_value_typeNG + " .");
                kb.add("<SL" + quant_value_typeNG + "Instance> bp:hasSLE" + quant_value_typeNG + " <SLE" + quant_value_typeNG + "Instance> .");

                // Var instance
                kb.add("<Var" + quant_value_typeNG + "Instance> a " + "bp:Var" + quant_value_typeNG + " .");
                kb.add("<SLE" + quant_value_typeNG + "Instance> bp:hasVar" + quant_value_typeNG + " <Var" + quant_value_typeNG + "Instance> .");


                // bind var instance to the quant value instance
                kb.add("<" + quant_value_instNG + "> a bp:" + quant_value_typeNG + " .");
                // id = prefix + _i_ + instanceDescription
                kb.add("<" + quant_value_instNG + "> " + ' rdfs:label "' + instanceDescriptionNG + '"^^xsd:string .');
                // id = prefix + _i_ + uom
                kb.add("<" + quant_value_instNG + "> " + ' gr:hasUnitOfMeasurement "' + uomNG + '"^^xsd:string .')
                kb.add("<" + quant_value_instNG + "> " + "gr:valueReference " + "bp:" + quant_value_typeNG + "ValueRange .")
                kb.add("<Var" + quant_value_typeNG + "Instance>  " + "bp:hasDefault" + quant_value_typeNG + " <" + quant_value_instNG + "> .");

                // specify quant value instance  Here the parsing code has to be adapted!!!

                if (isRangeNG == true) {
                    // int or float value subclass
                    if (valueTypeNG == "integer") {
                        // Int value subclass
                        kb.add("<" + quant_value_instNG + "> " + ' gr:hasMinValueInteger "' + minValueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .')
                            .add("<" + quant_value_instNG + "> " + ' gr:hasMaxValueInteger "' + maxValueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .')
                    } else {
                        // Float value subclass

                        kb.add("<" + quant_value_instNG + "> " + ' gr:hasMinValueFloat "' + minValueNG + '"^^xsd:float .')
                            .add("<" + quant_value_instNG + "> " + ' gr:hasMaxValueFloat "' + maxValueNG + '"^^xsd:float .')

                    }
                } else {
                    // int or float value subclass
                    if (valueTypeNG == "integer") {
                        // Int value subclass

                        kb.add("<" + quant_value_instNG + "> " + ' gr:hasValueInteger "' + valueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .')
                            .add("<" + quant_value_instNG + "> " + ' gr:hasMinValueInteger "' + valueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .')
                            .add("<" + quant_value_instNG + "> " + ' gr:hasMaxValueInteger "' + valueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .')


                    } else {
                        // Float value subclass

                        kb.add("<" + quant_value_instNG + "> " + ' gr:hasValueFloat "' + valueNG + '"^^xsd:float .')
                            .add("<" + quant_value_instNG + "> " + ' gr:hasMinValueFloat "' + valueNG + '"^^xsd:float .')
                            .add("<" + quant_value_instNG + "> " + ' gr:hasMaxValueFloat "' + valueNG + '"^^xsd:float .')
                    }
                }
            }
            return kb;
        }

        function loadBP(event) {
            event.preventDefault();
            var dt = event.dataTransfer
            var files = dt.files
            if (files.length == 1) {

                var reader = new FileReader();
                reader.onload = function (event) {
                    var content = event.target.result;
                    var kb = $.rdf();
                    kb.load(content);

                    kb.prefix('foaf', 'http://xmlns.com/foaf/0.1/')
                        .prefix('rdf', 'http://www.w3.org/1999/02/22-rdf-syntax-ns#')
                        .prefix('rdfs', 'http://www.w3.org/2000/01/rdf-schema#')
                        .prefix('owl', 'http://www.w3.org/2002/07/owl#')
                        .prefix('dcterms', 'http://purl.org/dc/terms/')
                        .prefix('usdl-core', 'http://www.linked-usdl.org/ns/usdl-core#')
                        .prefix('usdl-core-cb', 'http://www.linked-usdl.org/ns/usdl-core/cloud-broker#')
                        .prefix('usdl-sla', 'http://www.linked-usdl.org/ns/usdl-sla#')
                        .prefix('usdl-sla-cb', 'http://www.linked-usdl.org/ns/usdl-core/cloud-broker-sla#')
                        .prefix('usdl-business-roles', 'http://www.linked-usdl.org/ns/usdl-business-roles#')
                        .prefix('blueprint', 'http://bizweb.sap.com/TR/blueprint#')
                        .prefix('vcard', 'http://www.w3.org/2006/vcard/ns#')
                        .prefix('xsd', 'http://www.w3.org/2001/XMLSchema#')
                        .prefix('ctag', 'http://commontag.org/ns#')
                        .prefix('org', 'http://www.w3.org/ns/org#')
                        .prefix('skos', 'http://www.w3.org/2004/02/skos/core#')
                        .prefix('time', 'http://www.w3.org/2006/time#')
                        .prefix('gr', 'http://purl.org/goodrelations/v1#')
                        .prefix('doap', 'http://usefulinc.com/ns/doap#')
                        .base(findBase(kb) + "#");

                    kb.prefix('bp', kb.base());

                    loadClassificationTaxonomy(kb);

                    loadClassificationConcepts(kb);


                    //Load SLP class
                    var slpclasses = kb.where("?slps rdfs:subClassOf usdl-sla:ServiceLevelProfile");
                    slpclasses.each(function () {
                        var sel = this["slps"];
                        var url_slps = sel.value._string;
                        document.getElementById("slp_class").value = url_slps.split('#')[1];
                    });


                    //no longer needed for bp-type2
                    //loadQualitativeSLSchemasNG(kb);
                    deactivateInputFields();
                    //Create quant values table

                    //no longer needed for bp-type2
                    //createQuantitativeSLValuesTable(kb);

                    //window.alert(kb.base());
                    document.kb = kb;
                    document.slpDimensions = extractServiceLevelDimensions(kb);

                    processExistingClassifications(kb);

                    generateExistingSLPs(kb);
                }
                reader.readAsText(files[0]);
                document.getElementById("bp").innerHTML = "Broker policy loaded!";
                $("#serviceEditArea").collapse('show');
                $("#serviceLoadArea").collapse('hide');

            }
        }

        function setExistingQuantitativeValue(kb, slpValueInstance, numberType, prefix) {
            var quant_value = [];
            if (numberType == "integer") {
                // Int value subclass
                quant_value = kb.where("bp:" + slpValueInstance + " rdfs:label ?description")
                    .where("bp:" + slpValueInstance + " gr:hasValueInteger ?val");
            } else {
                // Float value subclass
                var quant_value = kb.where("bp:" + slpValueInstance + " rdfs:label ?description")
                    .where("bp:" + slpValueInstance + " gr:hasValueFloat ?val");
            }
            quant_value.each(function () {
                document.getElementById(prefix + '_value').value = this["val"].value;
                document.getElementById(prefix + '_instanceDesc').value = this["description"].value;
            });
        }

        function setExistingQuantitativeValueRange(kb, slpValueInstance, numberType, prefix) {
            var quant_value = [];
            if (numberType == "integer") {
                // Int value range subclass
                // Query instance from the kb
                quant_value = kb.where("bp:" + slpValueInstance + " rdfs:label ?description")
                    .where("bp:" + slpValueInstance + " gr:hasMinValueInteger ?min")
                    .where("bp:" + slpValueInstance + " gr:hasMaxValueInteger ?max");
            } else {
                // Float value range subclass
                quant_value = kb.where("bp:" + slpValueInstance + " rdfs:label ?description")
                    .where("bp:" + slpValueInstance + " gr:hasMinValueFloat ?min")
                    .where("bp:" + slpValueInstance + " gr:hasMaxValueFloat ?max");
            }
            quant_value.each(function () {
                document.getElementById(prefix + '_minValue').value = this["min"].value;
                document.getElementById(prefix + '_maxValue').value = this["max"].value;
                document.getElementById(prefix + '_instanceDesc').value = this["description"].value;
            });
        }

        function extractExistingSLPs(kb) {
            var sl_properties = [];
            document.kb.where("?prop rdfs:subPropertyOf usdl-sla:hasServiceLevel").each(function () {
                sl_properties.push(this.prop.value._string);
            });
            var slpclasses = kb.where("?slp a ?slps")
                .where("?slps rdfs:subClassOf usdl-sla:ServiceLevelProfile");
            var slptResult = [];
            //Service Level Profile Type
            slpclasses.each(function () {
                var sel = this["slps"];
                var url_slps = sel.value._string;
                var selection = this["slp"];
                var url = selection.value._string;
                var sl_properties_result = {}; //[];
                sl_properties.forEach(function (prop) {
                    var sl_result;
                    var sel_value_instance;
                    //var sel_label;
                    var sl_url;
                    var sl = document.kb.where("<" + url + ">" + " <" + prop + "> " + "?sl");
                    sl.each(function () {
                        var sel = this["sl"];
                        sl_url = sel.value._string;
                        // Find label of the value instance
                        //var value_instance_result;
                        var value_instance = document.kb.where("<" + sl_url + ">" + " ?sle_prop " + " ?sle")
                            .where("?sle_prop rdfs:subPropertyOf usdl-sla:hasServiceLevelExpression")
                            .where("?sle ?var_prop ?var")
                            .where("?var_prop rdfs:subPropertyOf usdl-sla:hasVariable")
                            .where("?var ?value_prop ?value")
                            .where("?value rdfs:label ?text");
                        value_instance.each(function () {
                            sel_value_instance = this["value"].value._string;
                        });

                    });
                    sl_properties_result[prop.split("#hasSL")[1]] =
                        //sl_properties_result.push({
                        {
                            prop: prop,
                            sel_value_instance: sel_value_instance,
                            sl_url: sl_url
                        };
                    //});
                });
                sl_properties_result.url_slps = url_slps;
                sl_properties_result.url = url;

                slptResult.push(
                    sl_properties_result
                );
            });
            return slptResult;
        }

        function generateExistingSLPs(kb) {
            var slps = extractExistingSLPs(kb);
            var slpCounter = 0;
            slps.forEach(function (currentSLP) {
                slpCounter++;
                addSLPPanel();
                var slpInstanceName = currentSLP.url.split('#')[1];
                //set name of slp
                document.getElementById('slpPanel_' + slpCounter + '_name').value = slpInstanceName;

                //process quantitative values
                var quantValuesPanels = document.getElementById('slpPanel_' + slpCounter + '_quant_values').children;
                for (var i = 0; i < quantValuesPanels.length; i++) {
                    var currentPanel = quantValuesPanels[i];
                    var slpType = currentPanel.children[0].children[0].textContent;
                    if (currentSLP[slpType].sel_value_instance) {
                        var quantValueInstanceName = currentSLP[slpType].sel_value_instance.split('#' + slpInstanceName)[1];

                        document.getElementById('slpPanel_' + slpCounter + '_' + slpType + '_inUse').checked = true;
                        document.getElementById('slpPanel_' + slpCounter + '_' + slpType + '_instance').value = quantValueInstanceName;
                        var valueType = document.getElementById('slpPanel_' + slpCounter + '_' + slpType + '_valueType').value;
                        var isRange = document.getElementById('slpPanel_' + slpCounter + '_' + slpType + '_isRange').checked;
                        if (isRange) {
                            setExistingQuantitativeValueRange(kb, currentSLP[slpType].sel_value_instance.split('#')[1], valueType, 'slpPanel_' + slpCounter + '_' + slpType);
                        } else {
                            setExistingQuantitativeValue(kb, currentSLP[slpType].sel_value_instance.split('#')[1], valueType, 'slpPanel_' + slpCounter + '_' + slpType);
                        }
                    }
                }
                //process qualitative values
                //get quantv panel; get type; search type in SLP; set value
                var qualValuesPanels = document.getElementById('slpPanel_' + slpCounter + '_qual_values').children;
                for (var i = 0; i < qualValuesPanels.length; i++) {
                    var currentPanel = qualValuesPanels[i];
                    var slpType = currentPanel.children[0].children[0].textContent;
                    if (currentSLP[slpType].sel_value_instance) {
                        document.getElementById('slpPanel_' + slpCounter + '_' + slpType + '_inUse').checked = true;
                        document.getElementById('slpPanel_' + slpCounter + '_selectbox_' + slpType).value = currentSLP[slpType].sel_value_instance.split('#')[1];
                    }
                }
            });
            activateOrTriggerPanels(false);
        }


        function processExistingClassifications(kb) {
            var classconcepts = kb.where("?concept a usdl-core-cb:ClassificationDimension");

            classconcepts.each(function () {
                var selection = this["concept"];
                var url = selection.value._string;
                var selectelement = document.getElementById("classtaxonomy");
                var concept = document.createElement("option");
                concept.value = url;
                concept.text = url.split('#')[1];
                selectelement.add(concept, null);

            });
        }

        var elementUtil = {
            createTextBox: function (title, content, id) {
                var div = document.createElement('div');
                div.setAttribute('class', 'form-group');
                div.appendChild(function () {
                    var label = document.createElement('label');
                    label.htmlFor = id;
                    label.appendChild(document.createTextNode(title));
                    return label;
                });
                div.appendChild(function () {
                    var input = document.createElement('p');
                    input.id = id;
                    input.className('form-control-static');
                    input.appendChild(document.createTextNode(content));
                    return input;
                });
                return div;
            },

            createTextInputBox: function (title, content, id, readonly, descriptorSize, contentSize) {
                var div = document.createElement('div');
                div.setAttribute('class', 'form-group');
                div.appendChild(function () {
                    var label = document.createElement('label');
                    label.htmlFor = id;
                    label.className = 'col-sm-' + descriptorSize + ' control-label';
                    label.appendChild(document.createTextNode(title));
                    return label;
                }());
                div.appendChild(function () {
                    var innerDiv = document.createElement('div');
                    innerDiv.className = 'col-sm-' + contentSize;
                    innerDiv.appendChild(function () {
                        var input = document.createElement('input');
                        input.type = 'text';
                        input.id = id;
                        input.value = content;
                        input.className = 'form-control';
                        if (readonly) input.disabled = true;
                        return input;
                    }());
                    return innerDiv;
                }());
                return div;
            },
            createTextAreaBox: function (title, content, id, readonly, descriptorSize, contentSize) {
                var div = document.createElement('div');
                div.setAttribute('class', 'form-group');
                div.appendChild(function () {
                    var label = document.createElement('label');
                    label.htmlFor = id;
                    label.className = 'col-sm-' + descriptorSize + ' control-label';
                    label.appendChild(document.createTextNode(title));
                    return label;
                }());
                div.appendChild(function () {
                    var innerDiv = document.createElement('div');
                    innerDiv.className = 'col-sm-10';
                    innerDiv.appendChild(function () {
                        var input = document.createElement('textarea');
                        input.rows = 5;
                        input.id = id;
                        input.value = content;
                        input.className = 'form-control col-sm-' + contentSize;
                        if (readonly) input.disabled = true;
                        return input;
                    }());
                    return innerDiv;
                }());
                return div;
            },
            createCheckBox: function (title, check, id, descriptorSize, contentSize, enabled, onclickFunction) {
                var div = document.createElement('div');
                div.setAttribute('class', 'checkbox');
                div.appendChild(function () {
                    var label = document.createElement('label');

                    var checkbox = document.createElement('input');
                    checkbox.setAttribute("type", "checkbox");
                    checkbox.id = id;
                    checkbox.checked = check;
                    if (enabled) {
                        checkbox.disabled = false;
                    } else {
                        checkbox.disabled = true;
                    }
                    if (onclickFunction) checkbox.onclick = onclickFunction;
                    label.appendChild(checkbox);
                    label.appendChild(document.createTextNode(title));
                    return label;
                }());

                var outerDiv = document.createElement('div');
                outerDiv.className = 'col-sm-offset-' + descriptorSize + ' col-sm-' + contentSize;
                outerDiv.appendChild(div);
                return outerDiv;
            }

        }

        function loadClassificationTaxonomy(kb) {
            // load top concept
            var topconcept = kb.where("?concept a usdl-core-cb:ClassificationDimension")
                .where("?scheme a skos:ConceptScheme")
                .where("?concept skos:topConceptOf ?scheme");
            var tc = "";
            topconcept.each(function () {
                var selection = this["concept"];
                var tc_url = selection.value._string;

                tc = tc_url;
                document.getElementById("classtaxURI").value = tc_url.split("#")[0];
                document.getElementById("classtaxroot").valueclasstaxroot = tc_url.split("#")[1];
            })
            var query = "?classconcept skos:broader <" + tc + ">";

            var classconcepts = kb.where(query)
                .where("?classconcept a usdl-core-cb:ClassificationDimension");
            var c_url = "";
            classconcepts.each(function () {
                var selection = this["classconcept"];
                var c_url = selection.value._string;
                var table = document.getElementById("classtaxconcepts");

                var row = table.insertRow();


                var cell3 = row.insertCell();
                cell3.innerHTML = "<input type='text'>";
                cell3.childNodes[0].value = c_url.split("#")[1];

                var cell4 = row.insertCell();
                cell4.innerHTML = "<input type='text'>";
                var cell5 = row.insertCell();
                cell5.innerHTML = "<input type='text'>";

                var title = kb.where("<" + c_url + ">" + " dcterms:title ?title");
                title.each(function () {
                    cell4.childNodes[0].value = this["title"].value;
                })
                var label = kb.where("<" + c_url + ">" + " skos:prefLabel ?label");
                label.each(function () {
                    cell5.childNodes[0].value = this["label"].value;
                })

            })

        }

        function loadClassificationConcepts(kb) {
            var classconcepts = kb.where("?concept a usdl-core-cb:ClassificationDimension");

            classconcepts.each(function () {
                var selection = this["concept"];
                var url = selection.value._string;
                var selectelement = document.getElementById("classtaxonomy");
                var concept = document.createElement("option");
                concept.value = url;
                concept.text = url.split('#')[1];
                selectelement.add(concept, null);

            })
        }


        function storeBPtype2() {
            var kb_bp = document.kb;
            kb_bp = storeSLPsFromPanels(kb_bp);
            var dmp = kb_bp.databank.dump({
                format: 'text/turtle',
                indent: true,
                serialize: true
            });
            var uueFile = Base64.encode(dmp);
            var uri = 'data:text/turtle;base64,' + encodeURIComponent(uueFile);
            window.open(uri);
        }

        function addSLPPanel() {
            if (document.slpPanelCounter) {
                document.slpPanelCounter++;
            } else {
                document.slpPanelCounter = 1;
            }
            $("#serviceTab_add").before(function () {
                var li = document.createElement("li");
                li.setAttribute("role", "presentation");
                var a = document.createElement("a");
                a.setAttribute("href", '#slpPanel_' + document.slpPanelCounter);
                a.setAttribute("aria-controls", '#slpPanel_' + document.slpPanelCounter);
                a.setAttribute("role", "tab");
                a.setAttribute("data-toggle", "tab");
                a.appendChild(document.createTextNode("SLP " + document.slpPanelCounter));
                li.appendChild(a);
                return li;
            }());
            $("#serviceTab_add_panel").before(
                createServiceLevelProfilePanel(document.slpDimensions, {
                    quantitativeConfiguration: null,
                    qualitativeConfiguration: null
                }, 'slpPanel_' + document.slpPanelCounter));
            $('#SD_tab_list a[href="#slpPanel_' + document.slpPanelCounter + '"]').tab('show');
        }

        function createServiceLevelProfilePanel(slpDimensions, slpConfiguration, prefix) {
            var tabpanel = document.createElement('div');
            tabpanel.setAttribute('class', 'tab-pane');
            tabpanel.setAttribute('role', 'tabpanel');
            tabpanel.id = prefix;
            tabpanel.appendChild(function () {
                var panel = document.createElement('div');
                panel.setAttribute('class', 'panel panel-default panel1col');
                panel.appendChild(function () {
                    var panelHeading = document.createElement('div');
                    panelHeading.setAttribute('class', 'panel-heading');
                    var heading = document.createElement('h1');
                    heading.appendChild(document.createTextNode('Specify Your Service Level Profile'));
                    panelHeading.appendChild(heading);
                    return panelHeading;
                }());
                panel.appendChild(createServiceLevelProfilePanelBody(slpDimensions, slpConfiguration, prefix));
                return panel;
            }());
            return tabpanel;
        }

        function createServiceLevelProfilePanelBody(slpDimensions, slpConfiguration, prefix) {
            var panelBody = document.createElement('div');
            panelBody.setAttribute('class', 'panel-body');
            // add form to enter SLP name
            panelBody.appendChild(function () {
                var form = document.createElement('form');
                form.className = 'form-horizontal';
                var formGroup = document.createElement('div');
                formGroup.className = 'form-group';
                form.appendChild(formGroup);


                var nameLabel = document.createElement('label');
                nameLabel.className = 'col-sm-2 control-label';
                nameLabel.setAttribute('for', prefix + '_name');
                nameLabel.appendChild(document.createTextNode('Name'));

                formGroup.appendChild(nameLabel);
                var div = document.createElement('div');
                div.className = 'col-sm-9';
                var input = document.createElement('input');
                input.className = 'form-control';
                input.setAttribute('type', 'text');
                input.id = prefix + '_name';
                input.value = prefix + "_name";
                div.appendChild(input);
                formGroup.appendChild(div);
                return form;
            }());
            panelBody.appendChild(createInnerSLPPanel('Specify Quantitative Service Levels', prefix + '_quant',
                createQuantitativeServiceLevelEditor(prefix, slpDimensions.quantitative, slpConfiguration.quantitativeConfiguration)));
            panelBody.appendChild(createInnerSLPPanel('Specify Qualitative Service Levels', prefix + '_qual',
                createQualitativeServiceLevelEditor(prefix, slpDimensions.qualitative, slpConfiguration.qualitativeConfiguration)));
            return panelBody;
        }

        function createInnerSLPPanel(headerText, bodyId, panelBodyContents) {
            var panel = document.createElement('div');
            panel.setAttribute('class', 'panel panel-default panel1col');
            //add panel heading
            panel.appendChild(function () {
                var div = document.createElement('div');
                div.className = 'panel-heading';
                var h2 = document.createElement('h2');
                h2.appendChild(document.createTextNode(headerText));
                div.appendChild(h2);
                return div;
            }());
            //add panel body
            panel.appendChild(function () {
                var div = document.createElement('div');
                div.className = 'panel-body';
                div.appendChild(panelBodyContents);
                return div;
            }());
            return panel;
        }

        function createQualitativeServiceLevelEditor(prefix, qualitativeDimensions, qualitativeConfiguration) {
            //qualitativeDimensions:
            // format: [{value: "val", description: "desc", options: [{value: "optValue", description: "descr"},..]}..]
            var div = document.createElement('div');
            div.id = prefix + '_qual_values';
            //referenz zu loadQualitativeSLSchemasNG
            qualitativeDimensions.forEach(function (currentDimension) {
                //create table
                var qvTable = document.createElement('table');
                qvTable.setAttribute('id', prefix + "_qual_values_" + currentDimension.value);
                qvTable.setAttribute('style', 'width: 90%');
                var qvHeader = qvTable.insertRow();
                [{
                    content: 'Value',
                    class: 'col-sm-3'
                }, {
                    content: 'Description',
                    class: 'col-sm-9'
                }].forEach(function (descriptor) {
                    var headerCell = document.createElement('th');
                    if (descriptor.content) headerCell.appendChild(document.createTextNode(descriptor.content));
                    if (descriptor.class) headerCell.setAttribute('class', descriptor.class);
                    qvHeader.appendChild(headerCell);
                });
                //create selectbox
                var selectbox = document.createElement("SELECT");
                selectbox.setAttribute('id', prefix + '_selectbox_' + currentDimension.value);

                currentDimension.options.forEach(function (currentOption) {
                    var qvRow = qvTable.insertRow();
                    var sl = document.createElement('input');
                    sl.setAttribute('type', 'text');
                    sl.setAttribute('value', currentOption.value);
                    sl.setAttribute('disabled', 'true');
                    qvRow.insertCell().appendChild(sl);
                    var slDesc = document.createElement('input');
                    slDesc.setAttribute('type', 'text');
                    slDesc.setAttribute('value', currentOption.description);
                    slDesc.setAttribute('disabled', 'true');
                    qvRow.insertCell().appendChild(slDesc);

                    var selectOption = document.createElement('option');
                    selectOption.setAttribute('value', currentOption.value);
                    selectOption.appendChild(document.createTextNode(currentOption.value));
                    selectbox.appendChild(selectOption);
                });

                var panel = document.createElement('div');
                panel.className = 'panel panel-default';
                panel.id = prefix + "_" + currentDimension.value;
                var panelHeader = document.createElement('div');
                panelHeader.className = 'panel-heading';


                var header = document.createElement('H2');
                var headerCheckbox = document.createElement('input');

                headerCheckbox.type = 'checkbox';
                headerCheckbox.style = 'float:inherit;';
                headerCheckbox.id = prefix + '_' + currentDimension.value + '_inUse';
                headerCheckbox.onclick = function () {
                    if (this.checked == true) {
                        document.getElementById(prefix + '_panel-body_' + currentDimension.value).hidden = false;
                        document.getElementById(prefix + '_panel-body-dummy_' + currentDimension.value).hidden = true;
                    } else {
                        document.getElementById(prefix + '_panel-body_' + currentDimension.value).hidden = true;
                        document.getElementById(prefix + '_panel-body-dummy_' + currentDimension.value).hidden = false;
                    }
                };

                header.appendChild(headerCheckbox);
                header.appendChild(document.createTextNode(currentDimension.value));
                panelHeader.appendChild(header);

                var panelBody = document.createElement('div');
                panelBody.className = 'panel-body';
                panelBody.id = prefix + '_panel-body_' + currentDimension.value;
                //TODO vielleicht hier noch irgendwo den value reinschreiben, um ihn später leichter auslesen zu können
                var descriptionNode = document.createElement('p');
                descriptionNode.appendChild(document.createTextNode(currentDimension.description));
                panelBody.appendChild(descriptionNode);



                panelBody.appendChild(qvTable);
                panelBody.appendChild(selectbox);
                var panelBodyDummy = document.createElement('div');
                panelBodyDummy.appendChild(document.createTextNode('No value for service level ' + currentDimension.value + '.'));
                panelBodyDummy.className = 'panel-body';
                panelBodyDummy.id = prefix + '_panel-body-dummy_' + currentDimension.value;
                panelBodyDummy.hidden = true;
                panel.appendChild(panelHeader);
                panel.appendChild(panelBody);
                panel.appendChild(panelBodyDummy);
                div.appendChild(panel);
            });
            //

            //und loadQualValuesNG
            return div;
        }

        function createQuantitativeServiceLevelEditor(prefix, quantitativeDimensions, quantitativeConfiguration) {
            //quantitativeDimensions
            //format [{type: "AmmountOfCpu",  valueType: "float", uom: "", minValue: -1, maxValue: -1, isRange: false, higherIsBetter: false}, ...]

            var div = document.createElement('div');
            div.id = prefix + '_quant_values';

            quantitativeDimensions.forEach(function (qv) {
                var localPrefix = prefix + "_" + qv.type;
                var panel = document.createElement('div');
                panel.className = "panel panel-default panel2col";
                panel.appendChild(function () {
                    var panelHeading = document.createElement('div');
                    panelHeading.className = 'panel-heading';

                    panelHeading.appendChild(function () {
                        var header = document.createElement('h2');
                        var headerCheckbox = document.createElement('input');

                        headerCheckbox.type = 'checkbox';
                        headerCheckbox.style = 'float:inherit;';
                        headerCheckbox.id = localPrefix + '_inUse';
                        headerCheckbox.onclick = function () {
                            if (this.checked == true) {
                                document.getElementById(localPrefix + '_panel-body').hidden = false;
                                document.getElementById(localPrefix + '_panel-body-dummy').hidden = true;
                            } else {
                                document.getElementById(localPrefix + '_panel-body').hidden = true;
                                document.getElementById(localPrefix + '_panel-body-dummy').hidden = false;
                            }
                        };

                        header.appendChild(headerCheckbox);
                        header.appendChild(document.createTextNode(qv.type));
                        header.id = localPrefix + '_type';
                        return header;
                    }());
                    return panelHeading;
                }());

                var form = document.createElement('form');
                form.setAttribute('class', 'form-horizontal');
                form.setAttribute('id', localPrefix + '_form');
                form.appendChild(function () {
                    var paragraph = document.createElement('p');
                    paragraph.appendChild(document.createTextNode(qv.description));
                    return paragraph;
                }());

                form.appendChild(
                    elementUtil.createTextInputBox('Service Level', '', localPrefix + '_instance', false, 2, 10)
                );
                form.appendChild(
                    elementUtil.createTextInputBox('Service Level Description', '', localPrefix + '_instanceDesc', false, 2, 10)
                );
                form.appendChild(
                    elementUtil.createTextInputBox('Unit of Measurement', qv.uom, localPrefix + '_uom', true, 2, 10)
                );
                form.appendChild(
                    elementUtil.createTextInputBox('Value type', qv.valueType, localPrefix + '_valueType', true, 2, 10)
                );
                if (!qv.isRange) {
                    form.appendChild(
                        elementUtil.createTextInputBox('Min Value', qv.minValue, localPrefix + '_minValue', true, 2, 10)
                    );
                    form.appendChild(
                        elementUtil.createTextInputBox('Value', '', localPrefix + '_value', false, 2, 10)
                    );
                    form.appendChild(
                        elementUtil.createTextInputBox('Max Value', qv.maxValue, localPrefix + '_maxValue', true, 2, 10)
                    );
                } else {
                    form.appendChild(
                        elementUtil.createTextInputBox('Min Value', qv.minValue, localPrefix + '_minValue', false, 2, 10)
                    );
                    form.appendChild(
                        elementUtil.createTextInputBox('Max Value', qv.maxValue, localPrefix + '_maxValue', false, 2, 10)
                    );
                }
                form.appendChild(elementUtil.createCheckBox('Is Range', qv.isRange, localPrefix + '_isRange', 2, 4));
                form.appendChild(elementUtil.createCheckBox('Higher is Better', qv.higherIsBetter, localPrefix + '_higherIsBetter', 2, 4));



                panel.appendChild(function () {
                    var panelBody = document.createElement('div');
                    panelBody.className = 'panel-body';
                    panelBody.id = localPrefix + '_panel-body';
                    panelBody.appendChild(form);
                    return panelBody;
                }());
                panel.appendChild(function () {
                    var panelBodyDummy = document.createElement('div');
                    panelBodyDummy.appendChild(document.createTextNode('No value for service level ' + qv.type + '.'));
                    panelBodyDummy.className = 'panel-body';
                    panelBodyDummy.id = localPrefix + '_panel-body-dummy';
                    panelBodyDummy.hidden = true;
                    return panelBodyDummy;
                }());
                div.appendChild(panel);
                //return panel;
            });
            return div;
        }

        //input
        function extractServiceLevelDimensions(kb) {
            //extract quantitative data
            var quantitativeStuff = [];
            var quant_serviceLevels_integer = kb.where("?qvc rdfs:subClassOf gr:QuantitativeValueInteger");
            quant_serviceLevels_integer.each(function () {
                var qv = {
                    valueType: "integer",
                    type: "",
                    uom: "",
                    minValue: -1,
                    maxValue: -1,
                    isRange: false,
                    higherIsBetter: false
                };
                var sls_url = this['qvc'].value._string;
                qv.type = sls_url.split("#")[1];
                //Label
                var label = kb.where("<" + sls_url + ">" + " rdfs:label ?label");
                label.each(function () {
                    qv.description = this["label"].value;
                });
                // uom
                var uom = kb.where("<" + sls_url + ">" + " gr:hasUnitOfMeasurement ?uom");
                uom.each(function () {
                    qv.uom = this["uom"].value;
                });
                // minvalue
                var minv = kb.where("<" + sls_url + ">" + " gr:hasMinValueInteger ?minv");
                minv.each(function () {
                    qv.minValue = this["minv"].value;
                });
                // maxValue
                var maxv = kb.where("<" + sls_url + ">" + " gr:hasMaxValueInteger ?maxv");
                maxv.each(function () {
                    qv.maxValue = this["maxv"].value;
                });
                //range
                var range = kb.where("<" + sls_url + ">" + " usdl-core-cb:isRange ?range");
                range.each(function () {
                    qv.isRange = this["range"].value;
                });
                //higher is better
                var hib = kb.where("<" + sls_url + ">" + " usdl-core-cb:higherIsBetter ?hib");
                hib.each(function () {
                    qv.higherIsBetter = this["hib"].value;
                });
                quantitativeStuff.push(qv);
            });

            var quant_serviceLevels_float = kb.where("?qvc rdfs:subClassOf gr:QuantitativeValueFloat");
            quant_serviceLevels_float.each(function () {
                var qv = {
                    valueType: "float",
                    type: "",
                    uom: "",
                    minValue: -1,
                    maxValue: -1,
                    isRange: false,
                    higherIsBetter: false
                };
                var sls_url = this['qvc'].value._string;
                qv.type = sls_url.split("#")[1];
                //Label
                var label = kb.where("<" + sls_url + ">" + " rdfs:label ?label");
                label.each(function () {
                    qv.description = this["label"].value;
                });
                // uom
                var uom = kb.where("<" + sls_url + ">" + " gr:hasUnitOfMeasurement ?uom");
                uom.each(function () {
                    qv.uom = this["uom"].value;
                });
                // minvalue
                var minv = kb.where("<" + sls_url + ">" + " gr:hasMinValueFloat ?minv");
                minv.each(function () {
                    qv.minValue = this["minv"].value;
                });
                // maxValue
                var maxv = kb.where("<" + sls_url + ">" + " gr:hasMaxValueFloat ?maxv");
                maxv.each(function () {
                    qv.maxValue = this["maxv"].value;
                });
                //range
                var range = kb.where("<" + sls_url + ">" + " usdl-core-cb:isRange ?range");
                range.each(function () {
                    qv.isRange = this["range"].value;
                });
                //higher is better
                var hib = kb.where("<" + sls_url + ">" + " usdl-core-cb:higherIsBetter ?hib");
                hib.each(function () {
                    qv.higherIsBetter = this["hib"].value;
                });
                quantitativeStuff.push(qv);
            });


            //extract qualitative data
            var qualitativeStuff = [];
            // format: [{value: "val", description: "desc", options: [{value: "optValue", description: "descr"},..]}..]
            var qual_sls = kb.where("?qvc rdfs:subClassOf gr:QualitativeValue");
            qual_sls.each(function () {
                var qv_options = [];

                var selection = this["qvc"];
                var sls_url = selection.value._string;
                //serviceLevel
                var serviceLevel = sls_url.split("#")[1];
                //serviceLevel Discription
                var serviceLevelDescription = '';
                var label = kb.where("<" + sls_url + ">" + " rdfs:label ?label");
                label.each(function () {
                    serviceLevelDescription = this["label"].value;
                });

                var serviceLevelValues = kb.where("?valinst a bp:" + serviceLevel + "");
                serviceLevelValues.each(function () {
                    var valueInstance = this["valinst"];
                    var qv_url = valueInstance.value._string;
                    var qv_value = qv_url.split('#')[1];

                    var qv_description = '';
                    var label = kb.where("<" + qv_url + ">" + " rdfs:label ?label");
                    label.each(function () {
                        qv_description = this["label"].value;
                    });
                    qv_options.push({
                        value: qv_value,
                        description: qv_description
                    });
                });
                qualitativeStuff.push({
                    value: serviceLevel,
                    description: serviceLevelDescription,
                    options: qv_options
                });
            });

            return {
                quantitative: quantitativeStuff,
                qualitative: qualitativeStuff
            };
        }

        //output preparation
        function getSLPsFromPanels(panels) {
            var slps = [];
            for (var panelCounter = 1; panelCounter < panels.length; panelCounter++) {
                var currentPanel = panels[panelCounter - 1];
                var currentSLP = {};
                currentSLP.prefix = currentPanel.id;
                currentSLP.name = document.getElementById("slpPanel_" + panelCounter + "_name").value;

                var qualitativeSL = [];
                currentSLP.qualitative = qualitativeSL;
                var qualValuesPanels = document.getElementById("slpPanel_" + panelCounter + "_qual_values").children;
                for (var i = 0; i < qualValuesPanels.length; i++) {
                    var qualValueType = qualValuesPanels[i].id.replace("slpPanel_" + panelCounter + "_", "");
                    if (document.getElementById("slpPanel_" + panelCounter + "_" + qualValueType + '_inUse').checked) {
                        var qualValue = document.getElementById("slpPanel_" + panelCounter + "_selectbox_" + qualValueType).value;
                        qualitativeSL.push({
                            type: qualValueType,
                            value: qualValue
                        });
                    }
                }

                var quantitativeSL = [];
                currentSLP.quantitative = quantitativeSL;
                var quantValuePanels = document.getElementById("slpPanel_" + panelCounter + "_quant_values").children;
                for (var i = 0; i < quantValuePanels.length; i++) {
                    var quantValueType = quantValuePanels[i].children[0].children[0].textContent;
                    var prefix = "slpPanel_" + panelCounter + "_" + quantValueType;
                    var idType = prefix + '_type';
                    var idInstance = prefix + '_instance';
                    var idInstanceDesc = prefix + '_instanceDesc';
                    var idUom = prefix + '_uom';
                    var idIsRange = prefix + '_isRange';
                    var idValueType = prefix + '_valueType';
                    var idMinValue = prefix + '_minValue';
                    var idMaxValue = prefix + '_maxValue';
                    var idValue = prefix + '_value';

                    if (document.getElementById(prefix + '_inUse').checked) {
                        var quant_value_typeNG = document.getElementById(idType).textContent;
                        var quant_value_instNG = document.getElementById(idInstance).value;
                        var uomNG = document.getElementById(idUom).value;
                        var isRangeNG = document.getElementById(idIsRange).checked;
                        var minValueNG = document.getElementById(idMinValue).value;
                        var maxValueNG = document.getElementById(idMaxValue).value;
                        var valueNG = undefined;
                        if (!isRangeNG) {
                            valueNG = document.getElementById(idValue).value;
                        }
                        var valueTypeNG = document.getElementById(idValueType).value;
                        var instanceDescriptionNG = document.getElementById(idInstanceDesc).value;

                        quantitativeSL.push({
                            quant_value_typeNG: quant_value_typeNG,
                            quant_value_instNG: quant_value_instNG,
                            uomNG: uomNG,
                            isRangeNG: isRangeNG,
                            minValueNG: minValueNG,
                            maxValueNG: maxValueNG,
                            valueNG: valueNG,
                            valueTypeNG: valueTypeNG,
                            instanceDescriptionNG: instanceDescriptionNG
                        });
                    }
                }
                slps.push(currentSLP);
            }
            return slps;
        }


        //output
        function storeSLPsFromPanels(kb) {
            var panels = document.getElementById('SD_tab_content').children;
            var slpData = getSLPsFromPanels(panels);

            slpData.forEach(function (currentSLP, slpCounter) {
                var name = currentSLP.name;
                //needed: sd_model ->Service Model Name - ersetzt durch slp+Model
                //        slp -> Service Level Profile Title
                kb.add("bp:" + name + "Model a bp:" + document.getElementById("bp_instance").value + " .")


                // Create and assign a profile instance to the service model
                .add("bp:" + name + " a bp:" + document.getElementById("slp_class").value + " .")
                    .add("bp:" + name + "Model bp:has" + document.getElementById("slp_class").value + " bp:" + name + " .");

                currentSLP.qualitative.forEach(function (currentQualInstance) {
                    // SL instance
                    kb.add("bp:" + name + "SL" + currentQualInstance.type + "Instance a " + "bp:SL" + currentQualInstance.type + " .")
                        .add("bp:" + name + " bp:hasSL" + currentQualInstance.type + " bp:" + name + "SL" + currentQualInstance.type + "Instance .")

                    // SLE instance
                    kb.add("bp:" + name + "SLE" + currentQualInstance.type + "Instance a " + "bp:SLE" + currentQualInstance.type + " .")
                        .add("bp:" + name + "SL" + currentQualInstance.type + "Instance bp:hasSLE" + currentQualInstance.type + " bp:" + name + "SLE" + currentQualInstance.type + "Instance .");

                    // Var instance
                    kb.add("bp:" + name + "Var" + currentQualInstance.type + "Instance a " + "bp:Var" + currentQualInstance.type + " .")
                        .add("bp:" + name + "SLE" + currentQualInstance.type + "Instance bp:hasVar" + currentQualInstance.type + " bp:" + name + "Var" + currentQualInstance.type + "Instance .")

                    // bind var instance to the qual value instance
                    kb.add("bp:" + name + "Var" + currentQualInstance.type + "Instance  " + "bp:hasDefault" + currentQualInstance.type + " bp:" + currentQualInstance.value + " .");

                });
                currentSLP.quantitative.forEach(function (currentQuantInstance) {
                    // SL instance
                    kb.add("bp:" + name + "SL" + currentQuantInstance.quant_value_typeNG + "Instance a " + "bp:SL" + currentQuantInstance.quant_value_typeNG + " .");
                    //slp.value == name+"Model"
                    kb.add("bp:" + name + " bp:hasSL" + currentQuantInstance.quant_value_typeNG + " bp:" + name + "SL" + currentQuantInstance.quant_value_typeNG + "Instance .");

                    // SLE instance
                    kb.add("bp:" + name + "SLE" + currentQuantInstance.quant_value_typeNG + "Instance a " + "bp:SLE" + currentQuantInstance.quant_value_typeNG + " .");
                    kb.add("bp:" + name + "SL" + currentQuantInstance.quant_value_typeNG + "Instance bp:hasSLE" + currentQuantInstance.quant_value_typeNG + " bp:" + name + "SLE" + currentQuantInstance.quant_value_typeNG + "Instance .");

                    // Var instance
                    kb.add("bp:" + name + "Var" + currentQuantInstance.quant_value_typeNG + "Instance a " + "bp:Var" + currentQuantInstance.quant_value_typeNG + " .");
                    kb.add("bp:" + name + "SLE" + currentQuantInstance.quant_value_typeNG + "Instance bp:hasVar" + currentQuantInstance.quant_value_typeNG + " bp:" + name + "Var" + currentQuantInstance.quant_value_typeNG + "Instance .");


                    // bind var instance to the quant value instance
                    kb.add("bp:" + name + currentQuantInstance.quant_value_instNG + " a bp:" + currentQuantInstance.quant_value_typeNG + " .");
                    // id = prefix + _i_ + instanceDescription
                    kb.add("bp:" + name + currentQuantInstance.quant_value_instNG + ' rdfs:label "' + currentQuantInstance.instanceDescriptionNG + '"^^xsd:string .');
                    // id = prefix + _i_ + uom
                    kb.add("bp:" + name + currentQuantInstance.quant_value_instNG + ' gr:hasUnitOfMeasurement "' + currentQuantInstance.uomNG + '"^^xsd:string .');
                    kb.add("bp:" + name + currentQuantInstance.quant_value_instNG + " gr:valueReference " + "bp:" + currentQuantInstance.quant_value_typeNG + "ValueRange .");
                    kb.add("bp:" + name + "Var" + currentQuantInstance.quant_value_typeNG + "Instance  " + "bp:hasDefault" + currentQuantInstance.quant_value_typeNG + " bp:" + name + currentQuantInstance.quant_value_instNG + " .");

                    // specify quant value instance  Here the parsing code has to be adapted!!!

                    if (currentQuantInstance.isRangeNG == true) {
                        // int or float value subclass
                        // id = prefix + _i_ + valueType
                        if (currentQuantInstance.valueTypeNG == "integer") {
                            // Int value subclass
                            // id = prefix + _i_ + 
                            kb.add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasMinValueInteger "' + currentQuantInstance.minValueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .')
                                .add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasMaxValueInteger "' + currentQuantInstance.maxValueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .');
                        } else {
                            // Float value subclass

                            kb.add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasMinValueFloat "' + currentQuantInstance.minValueNG + '"^^xsd:float .')
                                .add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasMaxValueFloat "' + currentQuantInstance.maxValueNG + '"^^xsd:float .');

                        }
                    } else {
                        // int or float value subclass
                        if (currentQuantInstance.valueTypeNG == "integer") {
                            // Int value subclass

                            kb.add("bp:" + name + "" + currentQuantInstance.quant_value_instNG + " " + ' gr:hasValueInteger "' + currentQuantInstance.valueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .')
                                .add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasMinValueInteger "' + currentQuantInstance.valueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .')
                                .add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasMaxValueInteger "' + currentQuantInstance.valueNG + '"^^<http://www.w3.org/2001/XMLSchema#integer> .');


                        } else {
                            // Float value subclass

                            kb.add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasValueFloat "' + currentQuantInstance.valueNG + '"^^xsd:float .')
                                .add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasMinValueFloat "' + currentQuantInstance.valueNG + '"^^xsd:float .')
                                .add("bp:" + name + currentQuantInstance.quant_value_instNG + " " + ' gr:hasMaxValueFloat "' + currentQuantInstance.valueNG + '"^^xsd:float .');
                        }
                    }

                });
                kb.add('bp:' + document.getElementById('bp_instance').value + ' bp:has' + document.getElementById('slp_class').value + ' bp:' + name);
            });

            return kb;
        }

        function activateOrTriggerPanels(activate) {
            var panels = document.getElementById('SD_tab_content').children;
            for (var panelCounter = 1; panelCounter < panels.length; panelCounter++) {
                var currentPanel = panels[panelCounter - 1];
                var qualValuesPanels = document.getElementById("slpPanel_" + panelCounter + "_qual_values").children;
                for (var i = 0; i < qualValuesPanels.length; i++) {
                    var qualValueType = qualValuesPanels[i].id.replace("slpPanel_" + panelCounter + "_", "");
                    var qualCheckbox = document.getElementById("slpPanel_" + panelCounter + "_" + qualValueType + '_inUse');
                    if (activate) {
                        qualCheckbox.checked = true;
                    }
                    qualCheckbox.onclick();
                }
                var quantValuePanels = document.getElementById("slpPanel_" + panelCounter + "_quant_values").children;
                for (var i = 0; i < quantValuePanels.length; i++) {
                    var quantValueType = quantValuePanels[i].children[0].children[0].textContent;
                    var prefix = "slpPanel_" + panelCounter + "_" + quantValueType;
                    var quantCheckbox = document.getElementById(prefix + '_inUse');
                    if (activate) {
                        quantCheckbox.checked = true;
                    }
                    quantCheckbox.onclick();
                }
            }
        }
    </script>
</head>

<body style="background-color: lightsilver">
    <div class="jumbotron">
        <div class="container">
            <div class="col-md-3">
                <a href="http://www.broker-cloud.eu/">
                    <img src="images/BrokerAtCloud_medium.png" alt="Broker@Cloud Logo" style="width:100%">
                </a>
            </div>
            <div class="col-md-9">
                <h1> Welcome to the Broker@Cloud Broker Policy Editor for Type 2 Broker Policies </h1>
                <p>This editor supports instantiation of multiple profiles after a broker policy has been created with the broker policy editor for type 1 broker policies.</p>
            </div>
        </div>
    </div>
    <div class="container" role="main">

        <div class="col-md-12">
            <div class="row">
                <div id="serviceLoadArea" class="collapse in">

                    <p>Note: You have to load a valid broker policy of type 1 into the editor.</p>
                    <h1> Use drag and drop functionality to load the file containing the broker policy!</h1>

                    <div class="droptarget" ondrop="loadBP(event)" ondragover="allowDrop(event)">
                        <p id="bp"> Drop your broker policy here! </p>
                    </div>

                </div>
                <div id="serviceEditArea" class="collapse">
                    <div class="container">
                        <div class="col-sm-12">
                            <div class="panel panel-default panel1col">
                                <div class="panel-heading">
                                    <h1> Broker Policy </h1>
                                </div>
                                <div class="panel-body" id="myblubb">
                                    <form class="form-horizontal">
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label" for="bp_namespace">Broker namespace</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="bp_namespace" placeholder="http://yourbrokernamespace.com"> </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label" for="bp_business_entity">Broker acronym</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="bp_business_entity" placeholder="YourBrokerCompanyAcronym">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label" for="bp_legal_name">Broker legal name</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="bp_legal_name" placeholder="Your BrokerCompany Legal Name">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label" for="bp_instance">Broker policy title</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="bp_instance" placeholder="YourBrokerPolicyTitle">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label" for="bp_model">Broker policy model name</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="bp_model" placeholder="YourBrokerPolicyModelName">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label" for="slp_class">Service Level Profile Type</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="slp_class" placeholder="SomeServiceLevelProfile">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label">Valid from</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="valid_from" value="YYYY-MM-DD">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label">Valid through</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="valid_through" value="YYYY-MM-DD">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label">Is successor of (URI to the predecessor broker policy, if any)</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="successor_of_bp" value="">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label">Service onboarding deprecation (for predecessor broker policy)</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="onboarding_deprecated_from" value="YYYY-MM-DD">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label">Service recommendation deprecation (for predecessor broker policy)</label>
                                            <div class="col-sm-8">
                                                <input class="form-control" type="text" id="recommendation_deprecated_from" value="YYYY-MM-DD">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>


                        </div>
                    </div>

                    <div class="panel panel-default panel1col">

                        <div class="panel-heading">
                            <h1> Classification taxonomy of the Broker Policy</h1>
                        </div>
                        <div class="panel-body">
                            <form class="form-horizontal">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="classtaxpref">Prefix</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="text" id="classtaxpref" value="fc">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="classtaxURI">URI</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="text" id="classtaxURI" value="http://www.broker-cloud.eu/service-descriptions/CAS/categories">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="classtaxroot">Root concept</label>
                                    <div class="col-sm-9">
                                        <input class="form-control" type="text" id="classtaxroot" value="rootConcept">
                                    </div>
                                </div>
                            </form>

                            <table class="table innerTable" id="classtaxconcepts">
                                <tr>
                                    <th class='col-sm-2'>Classification tag</th>
                                    <th class='col-sm-8'>Description</th>
                                    <th class='col-sm-2'>Label</th>
                                </tr>
                            </table>
                        </div>


                        <div class="panel panel-default innerPanel">
                            <div class="panel-heading">
                                <h2> Classify your service</h2>
                            </div>
                            <div class="panel-body">
                                <p>Available service classification concepts:
                                    <select name="classifications" id="classtaxonomy"> </select>
                                    <button class="btn btn-default" onclick="addConcept()"> Add </button>
                                    <button class="btn btn-default" onclick="deleteConcept()"> Delete </button>
                                    <table id="class_table">
                                    </table>
                                </p>

                            </div>
                        </div>
                        <input type="text" id="servicemodel_class" value="Broker Policy Class" disabled="disabled" hidden="hidden">
                        <input type="text" id="servicemodel" value="Broker Policy Instance" disabled="disabled" hidden="hidden">
                    </div>

                    <div>
                        <!-- Nav tabs -->
                        <ul id="SD_tab_list" class="nav nav-tabs" role="tablist">
                            <li id="serviceTab_add" role="presentation" onclick="{addSLPPanel(); activateOrTriggerPanels(true);}"><a href="#" aria-controls="serviceTab_2" role="tab" data-toggle="tab">Add SLP</a></li>
                        </ul>

                        <!-- Tab panes -->
                        <div class="tab-content" id="SD_tab_content">
                            <div role="tabpanel" class="tab-pane" id="serviceTab_add_panel">
                                <p>empty</p>
                            </div>
                        </div>

                    </div>


                    <div class="bc-buttongroup">
                        <button class="btn btn-default" onclick="storeBPtype2()">Show the service description specification. </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>